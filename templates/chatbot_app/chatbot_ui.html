{% load static %}
<style>
  /* Sticky Button */
  .chatbot-button {
    position: fixed;
    bottom: 30px;
    right: 30px;
    width: 60px;
    height: 60px;
    background-color: #007bff; /* Primary blue */
    color: white;
    border-radius: 50%;
    display: flex;
    justify-content: center;
    align-items: center;
    font-size: 1.5rem;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
    cursor: pointer;
    z-index: 1000; /* Ensure it's on top */
  }

  /* Chat UI Container */
  .chatbot-container {
    position: fixed;
    bottom: 100px; /* ë²„íŠ¼ ìœ„ìª½ì— ìœ„ì¹˜ */
    right: 30px;
    width: 380px; /* ì ë‹¹í•œ ì±—ë´‡ ì°½ ë„ˆë¹„ */
    height: 500px; /* ì ë‹¹í•œ ì±—ë´‡ ì°½ ë†’ì´ */
    background-color: #f8f9fa; /* Light background */
    border: 1px solid #dee2e6;
    border-radius: 10px;
    box-shadow: 0 8px 16px rgba(0, 0, 0, 0.3);
    display: flex;
    flex-direction: column;
    overflow: hidden;
    z-index: 999;
    transform: translateY(100%); /* Initially hidden below screen */
    opacity: 0;
    transition: transform 0.3s ease-out, opacity 0.3s ease-out; /* Animation */
  }

  .chatbot-container.active {
    transform: translateY(0); /* Slide up */
    opacity: 1;
  }

  .chatbot-header {
    background-color: #007bff;
    color: white;
    padding: 15px;
    border-top-left-radius: 9px;
    border-top-right-radius: 9px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-weight: bold;
  }

  .chatbot-header .close-btn {
    background: none;
    border: none;
    color: white;
    font-size: 1.5rem;
    cursor: pointer;
    padding: 0 5px;
  }

  .chatbot-body {
    flex-grow: 1;
    padding: 15px;
    overflow-y: auto; /* Scrollable chat area */
    background-color: white;
  }

  .chatbot-footer {
    padding: 15px;
    background-color: #e9ecef;
    border-bottom-left-radius: 9px;
    border-bottom-right-radius: 9px;
    display: flex;
  }

  /* ì±— ë©”ì‹œì§€ ìŠ¤íƒ€ì¼ */
  .chat-message {
    padding: 8px 12px;
    border-radius: 15px;
    margin-bottom: 10px;
    max-width: 80%;
    word-wrap: break-word;
  }

  .chat-message.bot {
    background-color: #e2e6ea; /* Light gray for bot messages */
    align-self: flex-start;
    border-bottom-left-radius: 2px;
  }

  .chat-message.user {
    background-color: #007bff; /* Blue for user messages */
    color: white;
    align-self: flex-end;
    border-bottom-right-radius: 2px;
  }

  /* ì„œë¹„ìŠ¤ ì„ íƒ ë²„íŠ¼ ì»¨í…Œì´ë„ˆ */
  .service-options {
    display: flex;
    flex-direction: column;
    gap: 8px; /* ë²„íŠ¼ ì‚¬ì´ ê°„ê²© */
    margin-top: 10px;
  }

  .service-options .btn {
    width: 100%; /* ë²„íŠ¼ ë„ˆë¹„ë¥¼ 100%ë¡œ ì„¤ì • */
    text-align: center;
    white-space: normal; /* í…ìŠ¤íŠ¸ê°€ ê¸¸ ê²½ìš° ì¤„ ë°”ê¿ˆ */
  }

  /* ì±—ë´‡ ë°”ë”” ìŠ¤í¬ë¡¤ ë° ë©”ì‹œì§€ ì •ë ¬ */
  .chatbot-body {
    flex-grow: 1;
    padding: 15px;
    overflow-y: auto;
    background-color: white;
    display: flex; /* Flexbox ì‚¬ìš©í•˜ì—¬ ë©”ì‹œì§€ ì •ë ¬ */
    flex-direction: column; /* ì„¸ë¡œ ë°©í–¥ìœ¼ë¡œ ì •ë ¬ */
  }
</style>

<div class="chatbot-button" id="chatbotToggleBtn">ğŸ’¬</div>

<div class="chatbot-container" id="chatbotContainer">
  <div class="chatbot-header">
    <span>ìˆ˜íŒŒì AI ìƒë‹´</span>
    <button class="close-btn" id="chatbotCloseBtn">&times;</button>
  </div>
  <div class="chatbot-body" id="chatbotBody">
    <div class="chat-message bot">
      ì•ˆë…•í•˜ì„¸ìš”! ìˆ˜íŒŒì AI ìƒë‹´ ì±—ë´‡ì…ë‹ˆë‹¤. ë¬´ì—‡ì„ ë„ì™€ë“œë¦´ê¹Œìš”?
    </div>
    <div class="chat-message bot">ë¬¸ì˜í•˜ì‹¤ ì„œë¹„ìŠ¤ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”:</div>
    <div class="service-options" id="serviceOptions">
      <button
        class="btn btn-outline-primary service-select-btn"
        data-service="ìˆ˜íŒŒì ê³¼ì™¸"
      >
        ìˆ˜íŒŒì ê³¼ì™¸
      </button>
      <button
        class="btn btn-outline-primary service-select-btn"
        data-service="ìˆ˜íŒŒì ë‚­ë…"
      >
        ìˆ˜íŒŒì ë‚­ë…
      </button>
      <button
        class="btn btn-outline-primary service-select-btn"
        data-service="ì†Œë°© íˆì–´ë¡œ ë©¤ë²„ì‹­"
      >
        ì†Œë°© íˆì–´ë¡œ ë©¤ë²„ì‹­
      </button>
      <button
        class="btn btn-outline-primary service-select-btn"
        data-service="ê¸°íƒ€ ë¬¸ì˜"
      >
        ê¸°íƒ€ ë¬¸ì˜
      </button>
    </div>
  </div>
  <div class="chatbot-footer">
    <div style="flex-grow: 1">
      <input
        type="text"
        class="form-control"
        id="chatInput"
        placeholder="ë¬¸ì˜ ì‚¬í•­ì„ ì…ë ¥í•˜ì„¸ìš”..."
        disabled
      />
    </div>
    <div style="margin-left: 10px">
      <button
        type="submit"
        class="btn btn-primary"
        id="sendMessageBtn"
        disabled
      >
        ì „ì†¡
      </button>
    </div>
  </div>
</div>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    const toggleBtn = document.getElementById("chatbotToggleBtn");
    const closeBtn = document.getElementById("chatbotCloseBtn");
    const chatbotContainer = document.getElementById("chatbotContainer");
    const chatbotBody = document.getElementById("chatbotBody");
    const serviceOptions = document.getElementById("serviceOptions");
    const chatInput = document.getElementById("chatInput");
    const sendMessageBtn = document.getElementById("sendMessageBtn");

    let selectedService = null; // ì„ íƒëœ ì„œë¹„ìŠ¤ë¥¼ ì €ì¥í•  ë³€ìˆ˜

    // ì±—ë´‡ ë²„íŠ¼ í´ë¦­ ì‹œ ì±— UI í† ê¸€
    toggleBtn.addEventListener("click", function () {
      chatbotContainer.classList.toggle("active");
      if (chatbotContainer.classList.contains("active")) {
        chatbotBody.scrollTop = chatbotBody.scrollHeight; // ì±—ë´‡ ì—´ë¦´ ë•Œ ìŠ¤í¬ë¡¤ ìµœí•˜ë‹¨ìœ¼ë¡œ
      }
    });

    // ì±—ë´‡ ë‹«ê¸° ë²„íŠ¼ í´ë¦­ ì‹œ ì±— UI ìˆ¨ê¸°ê¸°
    closeBtn.addEventListener("click", function () {
      chatbotContainer.classList.remove("active");
      // ë‹«ì„ ë•Œ ìƒíƒœ ì´ˆê¸°í™” (ì˜µì…˜)
      resetChatbotState();
    });

    // ì„œë¹„ìŠ¤ ì„ íƒ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸
    serviceOptions.addEventListener("click", function (event) {
      if (event.target.classList.contains("service-select-btn")) {
        selectedService = event.target.dataset.service;
        displayMessage(`"${selectedService}"ë¥¼ ì„ íƒí•˜ì…¨ìŠµë‹ˆë‹¤.`, "user"); // ì‚¬ìš©ìê°€ ì„ íƒí•œ ê²ƒì²˜ëŸ¼ í‘œì‹œ
        displayMessage(
          `${selectedService}ì— ëŒ€í•´ ë¬¸ì˜ ì‚¬í•­ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.`,
          "bot"
        );

        // ì„œë¹„ìŠ¤ ì„ íƒ ë²„íŠ¼ ìˆ¨ê¸°ê³  ì…ë ¥ì°½ í™œì„±í™”
        serviceOptions.style.display = "none";
        chatInput.removeAttribute("disabled");
        sendMessageBtn.removeAttribute("disabled");
        chatInput.focus(); // ì…ë ¥ì°½ì— í¬ì»¤ìŠ¤

        // (ë‚˜ì¤‘ì—) ì„ íƒëœ ì„œë¹„ìŠ¤ì— ë”°ë¼ ë°±ì—”ë“œë¡œ ë°ì´í„°ë¥¼ ì „ì†¡í•˜ëŠ” ë¡œì§ ì¶”ê°€
      }
    });

    // ë©”ì‹œì§€ ì „ì†¡ (í˜„ì¬ëŠ” UI í…ŒìŠ¤íŠ¸ìš©)
    sendMessageBtn.addEventListener("click", function () {
      sendMessage();
    });

    chatInput.addEventListener("keypress", function (event) {
      if (event.key === "Enter") {
        sendMessage();
      }
    });

    function sendMessage() {
      const messageText = chatInput.value.trim();
      if (messageText) {
        displayMessage(messageText, "user");
        chatInput.value = ""; // ì…ë ¥ í•„ë“œ ì´ˆê¸°í™”
        // (ë‚˜ì¤‘ì—) ì´ ë©”ì‹œì§€ë¥¼ ë°±ì—”ë“œë¡œ ì „ì†¡í•˜ëŠ” ë¡œì§ ì¶”ê°€
        // í˜„ì¬ëŠ” AI ë‹µë³€ ë¡œì§ì´ ì—†ìœ¼ë¯€ë¡œ, ê°„ë‹¨í•œ ì‘ë‹µ í‘œì‹œ
        displayMessage(
          "ì£„ì†¡í•©ë‹ˆë‹¤. ì•„ì§ ë‹µë³€ ê¸°ëŠ¥ì„ ê°œë°œ ì¤‘ì…ë‹ˆë‹¤. (í…ŒìŠ¤íŠ¸ ë©”ì‹œì§€)",
          "bot"
        );
      }
    }

    // ë©”ì‹œì§€ë¥¼ ì±—ë´‡ ì°½ì— í‘œì‹œí•˜ëŠ” í•¨ìˆ˜
    function displayMessage(text, sender) {
      const messageDiv = document.createElement("div");
      messageDiv.classList.add("chat-message", sender);
      messageDiv.textContent = text;
      chatbotBody.appendChild(messageDiv);
      chatbotBody.scrollTop = chatbotBody.scrollHeight; // ìŠ¤í¬ë¡¤ì„ ìµœí•˜ë‹¨ìœ¼ë¡œ ì´ë™
    }

    // ì±—ë´‡ ìƒíƒœ ì´ˆê¸°í™” í•¨ìˆ˜ (ë‹«ì„ ë•Œ ë˜ëŠ” ìƒˆë¡œ ì‹œì‘í•  ë•Œ)
    function resetChatbotState() {
      selectedService = null;
      chatbotBody.innerHTML = `
                <div class="chat-message bot">ì•ˆë…•í•˜ì„¸ìš”! ìˆ˜íŒŒì AI ìƒë‹´ ì±—ë´‡ì…ë‹ˆë‹¤. ë¬´ì—‡ì„ ë„ì™€ë“œë¦´ê¹Œìš”?</div>
                <div class="chat-message bot">ë¬¸ì˜í•˜ì‹¤ ì„œë¹„ìŠ¤ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”:</div>
                <div class="service-options" id="serviceOptions">
                    <button class="btn btn-outline-primary service-select-btn" data-service="ìˆ˜íŒŒì ê³¼ì™¸">ìˆ˜íŒŒì ê³¼ì™¸</button>
                    <button class="btn btn-outline-primary service-select-btn" data-service="ìˆ˜íŒŒì ë‚­ë…">ìˆ˜íŒŒì ë‚­ë…</button>
                    <button class="btn btn-outline-primary service-select-btn" data-service="ì†Œë°© íˆì–´ë¡œ ë©¤ë²„ì‹­">ì†Œë°© íˆì–´ë¡œ ë©¤ë²„ì‹­</button>
                    <button class="btn btn-outline-primary service-select-btn" data-service="ê¸°íƒ€ ë¬¸ì˜">ê¸°íƒ€ ë¬¸ì˜</button>
                </div>
            `;
      chatInput.setAttribute("disabled", "true");
      sendMessageBtn.setAttribute("disabled", "true");

      // ì„œë¹„ìŠ¤ ì„ íƒ ë²„íŠ¼ ì»¨í…Œì´ë„ˆë¥¼ ë‹¤ì‹œ í™œì„±í™” (ìƒˆë¡œ ìƒì„±í–ˆìœ¼ë¯€ë¡œ ë‹¤ì‹œ DOMì—ì„œ ì°¾ì•„ì•¼ í•¨)
      const newServiceOptions = chatbotBody.querySelector(".service-options");
      if (newServiceOptions) {
        newServiceOptions.style.display = "flex"; // flexë¡œ ì„¤ì •í•˜ì—¬ ë²„íŠ¼ì´ ë³´ì´ê²Œ í•¨
        // resetChatbotStateê°€ í˜¸ì¶œëœ í›„ ìƒˆë¡œ ìƒì„±ëœ ë²„íŠ¼ì— ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆë¥¼ ë‹¤ì‹œ ì—°ê²°í•´ì•¼ í•˜ì§€ë§Œ,
        // í˜„ì¬ëŠ” DOMContentLoadedì—ì„œ í•œ ë²ˆë§Œ ë¶™ì´ë¯€ë¡œ, ì‹¤ì œ ë¡œì§ì—ì„œëŠ” ë™ì  ìš”ì†Œì— ëŒ€í•œ ì´ë²¤íŠ¸ ìœ„ì„ì„ ê³ ë ¤í•´ì•¼ í•©ë‹ˆë‹¤.
        // ì—¬ê¸°ì„œëŠ” ê°„ë‹¨í•œ UI í…ŒìŠ¤íŠ¸ì´ë¯€ë¡œ, ìƒˆë¡­ê²Œ ìƒì„±ëœ serviceOptionsì— ëŒ€í•œ ì´ë²¤íŠ¸ëŠ” ë‹¤ì‹œ ë¶™ì´ì§€ ì•ŠìŠµë‹ˆë‹¤.
        // ì‹¤ì œ ê°œë°œ ì‹œì—ëŠ” ì´ë²¤íŠ¸ ìœ„ì„ì„ ì‚¬ìš©í•˜ê±°ë‚˜, resetChatbotStateê°€ DOM êµ¬ì¡°ë¥¼ ë‹¤ì‹œ ê·¸ë¦¬ì§€ ì•Šê³  ë‚´ìš©ì„ ì—…ë°ì´íŠ¸í•˜ëŠ” ë°©ì‹ìœ¼ë¡œ ë³€ê²½í•´ì•¼ í•©ë‹ˆë‹¤.
      }
      // í˜„ì¬ ì½”ë“œì—ì„œëŠ” resetChatbotStateê°€ í˜¸ì¶œë  ë•Œ serviceOptionsê°€ ìƒˆë¡œ ìƒì„±ë˜ë¯€ë¡œ
      // serviceOptionsì— ëŒ€í•œ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆëŠ” resetChatbotState ì™¸ë¶€ì—ì„œ (DOMContentLoadedì²˜ëŸ¼) í•œ ë²ˆë§Œ ë¶™ì—¬ì„œëŠ” ì•ˆë©ë‹ˆë‹¤.
      // ì„ì‹œë¡œ, resetChatbotStateì—ì„œ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆë¥¼ ë‹¤ì‹œ ë¶™ì´ëŠ” ì½”ë“œë¥¼ í¬í•¨í•©ë‹ˆë‹¤. (ì‹¤ì œ í”„ë¡œì íŠ¸ì—ì„œëŠ” ì´ë²¤íŠ¸ ìœ„ì„ ê¶Œì¥)
      attachServiceOptionListeners();
    }

    // ì„œë¹„ìŠ¤ ì„ íƒ ë²„íŠ¼ì— ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆë¥¼ ë‹¤ì‹œ ë¶™ì´ëŠ” í•¨ìˆ˜
    function attachServiceOptionListeners() {
      const currentServiceOptionsContainer =
        chatbotBody.querySelector("#serviceOptions");
      if (currentServiceOptionsContainer) {
        currentServiceOptionsContainer.addEventListener(
          "click",
          function (event) {
            if (event.target.classList.contains("service-select-btn")) {
              selectedService = event.target.dataset.service;
              displayMessage(`"${selectedService}"ë¥¼ ì„ íƒí•˜ì…¨ìŠµë‹ˆë‹¤.`, "user");
              displayMessage(
                `${selectedService}ì— ëŒ€í•´ ë¬¸ì˜ ì‚¬í•­ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.`,
                "bot"
              );

              currentServiceOptionsContainer.style.display = "none";
              chatInput.removeAttribute("disabled");
              sendMessageBtn.removeAttribute("disabled");
              chatInput.focus();
            }
          }
        );
      }
    }
    // ì´ˆê¸° ë¡œë“œ ì‹œ ì„œë¹„ìŠ¤ ì˜µì…˜ ë¦¬ìŠ¤ë„ˆ ë¶™ì´ê¸°
    attachServiceOptionListeners();
  });
</script>
